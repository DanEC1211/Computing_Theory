<!DOCTYPE html>
<html>
<head>
  <title>Universo de Cadenas Binarias</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <form id="form">
    <label for="n">Introduce el valor de n (0-1000):</label>
    <input type="number" id="n" name="n" min="0" max="1000">
    <button type="button" id="auto">Ejecutar Automático</button>
    <button type="button" id="manual">Ejecutar Manual</button>
  </form>
  <div id="chart"></div>
  <a id="download" download="output.txt">Descargar archivo de texto</a>
  <script>
    var chart; // Variable para almacenar el gráfico

    document.getElementById('auto').addEventListener('click', function() {
      var n = document.getElementById('n').value;
      fetch('/auto', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ n }),
      })
      .then(response => response.json())
      .then(data => {
        updateChart(data);
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });

    document.getElementById('manual').addEventListener('click', function() {
      var n = document.getElementById('n').value;
      fetch('/manual', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ n }),
      })
      .then(response => response.json())
      .then(data => {
        updateChart(data);

        if (window.confirm('¿Quieres calcular otra "n"?')) {
          var nInput = document.getElementById('n');
          nInput.value = '';
          nInput.focus();
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });

    function updateChart(data) {
      var ctx = document.getElementById('chart').getContext('2d');
      if (chart) {
        // Si ya existe un gráfico, actualiza sus datos
        chart.data.labels = data.binaryStrings;
        chart.data.datasets[0].data = data.counts;
        chart.update();
      } else {
        // Si no existe un gráfico, crea uno nuevo
        chart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: data.binaryStrings,
            datasets: [{
              label: 'Número de unos',
              data: data.counts,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    }
  </script>
</body>
</html>